# Публикация приложения

## Обзор

Bimload.Gui может быть скомпилирован в самодостаточный (self-contained) исполняемый файл, который включает все необходимые зависимости .NET и не требует установки .NET Runtime на целевом компьютере.

## Требования для публикации

- **.NET SDK 8.0** или выше
- **Windows** (для компиляции Windows приложения)

## Способы публикации

### Способ 1: Использование скриптов (рекомендуется)

#### Windows (PowerShell)
```powershell
.\publish.ps1
```

#### Windows (Batch)
```cmd
publish.bat
```

### Способ 2: Ручная публикация через dotnet CLI

```powershell
dotnet publish Bimload.Gui\Bimload.Gui.csproj `
    -c Release `
    -r win-x64 `
    --self-contained true `
    -p:PublishSingleFile=true `
    -p:IncludeNativeLibrariesForSelfExtract=true `
    -o publish
```

### Параметры публикации

- **`-c Release`** — конфигурация сборки (Release для оптимизированной версии)
- **`-r win-x64`** — целевая платформа (Windows x64)
- **`--self-contained true`** — включает .NET Runtime в выходной файл
- **`-p:PublishSingleFile=true`** — создает один исполняемый файл вместо множества DLL
- **`-p:IncludeNativeLibrariesForSelfExtract=true`** — включает нативные библиотеки в exe
- **`-p:DebugType=None`** — отключает создание PDB файлов
- **`-p:DebugSymbols=false`** — отключает отладочные символы
- **`-o publish`** — выходная директория

## Результат публикации

После успешной публикации в папке `publish/` будут находиться:

```
publish/
├── Bimload.Gui.exe          # Основной исполняемый файл (self-contained)
└── creds/                    # Папка с конфигурационными файлами
    ├── heat_db.ini
    ├── ops.ini
    ├── ops_db.ini
    ├── scs.ini
    ├── scs_db.ini
    ├── vent.ini
    └── ws.ini
```

**Примечание**: PDB файлы (файлы отладочной информации) исключены из публикации для уменьшения размера выходной папки.

## Распространение приложения

Для распространения приложения достаточно скопировать:

1. **Bimload.Gui.exe** — основной исполняемый файл
2. **Папку `creds/`** со всеми `.ini` файлами

Приложение автоматически найдет папку `creds/` в той же директории, где находится exe файл.

## Размер выходного файла

Self-contained exe файл будет иметь размер примерно **70-100 МБ**, так как включает в себя:
- .NET 8.0 Runtime
- Все необходимые библиотеки
- Нативные библиотеки Windows

## Альтернативные варианты публикации

### Framework-dependent (требует установленный .NET Runtime)

Если на целевом компьютере уже установлен .NET 8.0 Runtime, можно создать более легкую версию:

```powershell
dotnet publish Bimload.Gui\Bimload.Gui.csproj `
    -c Release `
    -r win-x64 `
    --self-contained false `
    -p:PublishSingleFile=true `
    -o publish
```

Размер будет значительно меньше (~5-10 МБ), но потребуется установленный .NET Runtime.

### Другие платформы

Для публикации под другие платформы измените параметр `-r`:

- **Windows x86**: `-r win-x86`
- **Windows ARM64**: `-r win-arm64`

**Примечание**: Приложение использует Windows Forms и WMI, поэтому работает только на Windows.

## Обновление конфигурационных файлов

После публикации вы можете редактировать файлы в папке `creds/` без перекомпиляции приложения. Просто отредактируйте нужные `.ini` файлы в папке рядом с exe.

## Устранение проблем

### Папка creds не найдена

Если приложение не находит папку `creds/`, убедитесь, что:
1. Папка `creds/` находится в той же директории, что и `Bimload.Gui.exe`
2. В папке `creds/` есть хотя бы один `.ini` файл
3. У приложения есть права на чтение файлов в папке `creds/`

### Ошибки при запуске

Если exe файл не запускается:
1. Проверьте, что вы используете Windows (приложение работает только на Windows)
2. Убедитесь, что у вас есть права на выполнение файла
3. Проверьте антивирус — некоторые антивирусы могут блокировать self-contained приложения

## Оптимизация размера (опционально)

Для уменьшения размера можно использовать обрезку (trimming), но это может вызвать проблемы с рефлексией:

```powershell
dotnet publish Bimload.Gui\Bimload.Gui.csproj `
    -c Release `
    -r win-x64 `
    --self-contained true `
    -p:PublishSingleFile=true `
    -p:PublishTrimmed=true `
    -p:TrimMode=link `
    -o publish
```

**Внимание**: Используйте trimming только после тщательного тестирования, так как он может удалить необходимый код.

