# Публикация приложения

## Обзор

Bimload.Gui публикуется как framework-dependent исполняемый файл, который требует установленный .NET 8.0 Desktop Runtime на целевом компьютере. Это позволяет значительно уменьшить размер выходного файла (с ~150 МБ до ~5-10 МБ).

## Требования для публикации

- **.NET SDK 8.0** или выше
- **Windows** (для компиляции Windows приложения)

## Способы публикации

### Способ 1: Использование скриптов (рекомендуется)

#### Windows (PowerShell)
```powershell
.\publish.ps1
```

#### Windows (Batch)
```cmd
publish.bat
```

### Способ 2: Ручная публикация через dotnet CLI

```powershell
dotnet publish Bimload.Gui\Bimload.Gui.csproj `
    -c Release `
    -r win-x64 `
    --self-contained false `
    -p:PublishSingleFile=true `
    -p:DebugType=None `
    -p:DebugSymbols=false `
    -o publish
```

### Параметры публикации

- **`-c Release`** — конфигурация сборки (Release для оптимизированной версии)
- **`-r win-x64`** — целевая платформа (Windows x64)
- **`--self-contained false`** — не включает .NET Runtime в выходной файл (требуется установленный .NET 8.0 Runtime)
- **`-p:PublishSingleFile=true`** — создает один исполняемый файл вместо множества DLL
- **`-p:DebugType=None`** — отключает создание PDB файлов
- **`-p:DebugSymbols=false`** — отключает отладочные символы
- **`-o publish`** — выходная директория

## Результат публикации

После успешной публикации в папке `publish/` будут находиться:

```
publish/
├── Bimload.exe              # Основной исполняемый файл (~5-10 МБ)
└── creds/                    # Папка с конфигурационными файлами
    ├── heat_db.ini
    ├── ops.ini
    ├── ops_db.ini
    ├── scs.ini
    ├── scs_db.ini
    ├── vent.ini
    └── ws.ini
```

**Примечания**: 
- PDB файлы (файлы отладочной информации) исключены из публикации для уменьшения размера выходной папки.
- Размер exe файла значительно меньше (~5-10 МБ вместо ~150 МБ), так как .NET Runtime не включен.

## Распространение приложения

Для распространения приложения достаточно скопировать:

1. **Bimload.exe** — основной исполняемый файл
2. **Папку `creds/`** со всеми `.ini` файлами

Приложение автоматически найдет папку `creds/` в той же директории, где находится exe файл.

## Размер выходного файла

Framework-dependent exe файл будет иметь размер примерно **5-10 МБ**, так как не включает .NET Runtime. Приложение использует установленный на системе .NET 8.0 Desktop Runtime.

## Проверка наличия .NET Runtime

При запуске приложение автоматически проверяет наличие .NET 8.0 Runtime. Если Runtime отсутствует, отображается сообщение об ошибке с ссылкой на официальную страницу загрузки Microsoft:

- **Сообщение**: "Для работы приложения требуется .NET 8.0 Runtime"
- **Ссылка**: https://dotnet.microsoft.com/download/dotnet/8.0
- **Действие**: Автоматически открывается страница загрузки в браузере

## Альтернативные варианты публикации

### Self-contained (все зависимости включены)

Если требуется создать полностью самодостаточное приложение без зависимости от установленного .NET Runtime:

```powershell
dotnet publish Bimload.Gui\Bimload.Gui.csproj `
    -c Release `
    -r win-x64 `
    --self-contained true `
    -p:PublishSingleFile=true `
    -p:IncludeNativeLibrariesForSelfExtract=true `
    -p:DebugType=None `
    -p:DebugSymbols=false `
    -o publish
```

Размер будет значительно больше (~150 МБ), но не потребуется установленный .NET Runtime на целевом компьютере.

### Другие платформы

Для публикации под другие платформы измените параметр `-r`:

- **Windows x86**: `-r win-x86`
- **Windows ARM64**: `-r win-arm64`

**Примечание**: Приложение использует Windows Forms и WMI, поэтому работает только на Windows.

## Обновление конфигурационных файлов

После публикации вы можете редактировать файлы в папке `creds/` без перекомпиляции приложения. Просто отредактируйте нужные `.ini` файлы в папке рядом с exe.

## Устранение проблем

### Папка creds не найдена

Если приложение не находит папку `creds/`, убедитесь, что:
1. Папка `creds/` находится в той же директории, что и `Bimload.exe`
2. В папке `creds/` есть хотя бы один `.ini` файл
3. У приложения есть права на чтение файлов в папке `creds/`

### Ошибки при запуске

Если exe файл не запускается:
1. **Проверьте наличие .NET 8.0 Runtime**: Приложение автоматически покажет сообщение, если Runtime отсутствует. Установите .NET 8.0 Desktop Runtime с официального сайта Microsoft.
2. Проверьте, что вы используете Windows (приложение работает только на Windows)
3. Убедитесь, что у вас есть права на выполнение файла
4. Проверьте антивирус — некоторые антивирусы могут блокировать приложения

### Проверка установленного .NET Runtime

Чтобы проверить, установлен ли .NET 8.0 Runtime на вашем компьютере, выполните в командной строке:

```cmd
dotnet --list-runtimes
```

Вы должны увидеть строку вида:
```
Microsoft.WindowsDesktop.App 8.0.x [C:\Program Files\dotnet\shared\Microsoft.WindowsDesktop.App]
```

Если такой строки нет, установите .NET 8.0 Desktop Runtime с https://dotnet.microsoft.com/download/dotnet/8.0

## Оптимизация размера (опционально)

Для уменьшения размера можно использовать обрезку (trimming), но это может вызвать проблемы с рефлексией:

```powershell
dotnet publish Bimload.Gui\Bimload.Gui.csproj `
    -c Release `
    -r win-x64 `
    --self-contained true `
    -p:PublishSingleFile=true `
    -p:PublishTrimmed=true `
    -p:TrimMode=link `
    -o publish
```

**Внимание**: Используйте trimming только после тщательного тестирования, так как он может удалить необходимый код.

