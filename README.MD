# Скрипт автоматического обновления ПО

Запуск: двойным кликом мыши по *bimload.lnk*

Скрипт *bimload* это скрипт для разработчиков, полностью автоматизирующий получение новых версий ПО с FTP-сервера и его дальнейшую переустановку. Скрипт использует средство автоматизации **Windows PowerShell** от Microsoft.

Пример вывода скрипта при успешной работе:

<img src="./git/readme/не было установленной, не было файла.png" alt="Библиотека компонентов" width="400">

# Содержание

1. [Зачем](#зачем)
2. [Ввод данных](#ввод-данных)
3. [Что нужно для запуска](#что-нужно-для-запуска)
4. [Используемые технологии](#используемые-технологии)
5. [Проблемы проекта](#проблемы-проекта)

# Зачем

При разработке новые сборки ПО появляются часто. Есть польза от использования именно последней сборки. Однако неприятная рутина о скачивании, удалении и установке новой версии, а также затраты времени мешают наладить процесс по регулярной установке новой версии. Скрипт *bimload* решает такую проблему.

Функционал скрипта:

- подключение к FTP-серверу и чтение доступных версий требуемой программы
- чтение установленных в Windows версий требуемой программы
- скачивание дистрибутива с FTP или определение уже скачанного ранее файла, если на FTP найдена старшая сборка
- удаление старшей версии установленной программы
- установка новейшей сборки программы
- обновление нескольких программ в один запуск.

Скрипт может быть добавлен в автозагрузку или запускаться вручную. Запросов к пользователю во время работы скрипта нет. 

Во время работы скрипта переустанавливаемая программа должна быть закрыта.

# Ввод данных

Вся настройка данных производится в текстовых файлах в папке **/creds/**. 

В репозитории хранится пример настроечных данных в папке **/creds-sample/**. При использовании этих файлов в работе, папку нужно переименовать в **/creds/** перед использованием. 

Используется два типа настроечных файлов:
* **/creds/ftp** - файл с данными для доступа к серверу. Файл этого типа только один.  

    Содержимое:    
    `ftpUrl=` - адрес сервера и порт  
    `username=` - имя пользователя  
    `password=` - пароль   

* **/creds/<any-name>.credentials** - файлы с данными программы для переустановки. Этих файлов может быть любое количество. Они должны иметь расширение в виде *.credentials*, чтобы скрипт их обнаружил.
 
    Содержимое:  
    `ftpFolder=` - адрес директории на ftp, где лежит дистрибутив с программой  
    `localPath=` - адрес локальной директории, где лежит или куда будет скачан дистрибутив с программой  
    `productName=` - текстовый запрос к Windows Management Instrumentation, по которому будет найдена программа (или несколько программ) для переустановки с выбором старшей версии сборки  
    `fileVersionPattern=` - регулярное выражение, по которому из имени файла на FTP будет определяться версия сборки  
    `productVersionPattern=` - регулярное выражение, по которому из номера версии, полученному от Windows Management Instrumentation (например, *24.6677.6677*) будет определяться версия сборки (*6677*)

# Что нужно для запуска

Для первого запуска нужно:

- Добавить необходимую информацию в настроечные файлы как описано выше
- Изменить путь для свойства *Объект* во вкладке *Ярлык* для ярлыка **bimload.lnk**, как указано на скриншоте. Путь должен вести к файлу **bimload.ps1**, который лежит по соседству. Скриншот:

    <img src="./git/readme/setlnk.png" alt="Библиотека компонентов" width="300">


- Проверить установку чекбокса *Запуск от имени администратора* в окне, открывающемся по нажатию на кнопку *Дополнительно*, там же. Скриншот:

    <img src="./git/readme/setlnk2.png" alt="Библиотека компонентов" width="300">




# Используемые технологии

* Windows PowerShell
* Windows Management Instrumentation 

* File Transfer Protocol
* Регулярные выражения
* Markdown

# Проблемы проекта

* Остановка загрузки в диапазоне 420-500 Мб для больших файлов
* Программа не может отследить ошибки при установке, т.к. они не выдаются в PowerShell при используемом методе установки. Встречались такие:
    - отсутствует необходимая версия Платформы  
    - установщик выдает "Программа уже установлена" из-за некорректного удаления предыдущей версии

